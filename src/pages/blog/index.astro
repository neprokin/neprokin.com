---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Card from '../../components/ui/Card.astro';
import Badge from '../../components/ui/Badge.astro';

// Получаем все опубликованные посты
const allPosts = await getCollection('blog');
const publishedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

const featuredPosts = publishedPosts.filter(post => post.data.featured);
const regularPosts = publishedPosts.filter(post => !post.data.featured);
---

<Layout 
  title="Blog - neprokin.com"
  description="Articles about design systems, product design, and building better user experiences"
>
  <main class="container">
    <!-- Header -->
    <header style="padding: 64px 0 48px; text-align: center;">
      <h1 class="h1 text-accent" style="margin-bottom: 16px;">Blog</h1>
      <p class="body-large text-secondary" style="margin-bottom: 32px;">
        Thoughts on design systems, product design, and building better user experiences
      </p>
    </header>

    <!-- Featured Posts -->
    {featuredPosts.length > 0 && (
      <section style="margin-bottom: 64px;">
        <h2 class="h2" style="margin-bottom: 32px;">Featured Articles</h2>
        <div class="grid grid-1">
          {featuredPosts.map((post) => {
            const publishDate = new Intl.DateTimeFormat('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            }).format(post.data.publishDate);
            
            return (
              <Card>
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                  <Badge>Featured</Badge>
                  <span class="body text-secondary">{publishDate}</span>
                </div>
                <h3 class="body-large" style="margin-bottom: 12px;">
                  <a href={`/blog/${post.slug}`} class="text-accent">{post.data.title}</a>
                </h3>
                <p class="body text-secondary" style="margin-bottom: 16px;">{post.data.description}</p>
                {post.data.tags && (
                  <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px;">
                    {post.data.tags.slice(0, 3).map((tag) => (
                      <Badge>{tag}</Badge>
                    ))}
                  </div>
                )}
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <a href={`/blog/${post.slug}`} class="body text-accent">Read Article →</a>
                  {post.data.readingTime && (
                    <span class="body text-secondary">{post.data.readingTime} min read</span>
                  )}
                </div>
              </Card>
            );
          })}
        </div>
      </section>
    )}

    <!-- Regular Posts -->
    {regularPosts.length > 0 && (
      <section style="margin-bottom: 64px;">
        <h2 class="h2" style="margin-bottom: 32px;">All Articles</h2>
        <div class="grid grid-1">
          {regularPosts.map((post) => {
            const publishDate = new Intl.DateTimeFormat('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            }).format(post.data.publishDate);
            
            return (
              <Card>
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                  <h3 class="body-large">
                    <a href={`/blog/${post.slug}`} class="text-accent">{post.data.title}</a>
                  </h3>
                  <span class="body text-secondary">{publishDate}</span>
                </div>
                <p class="body text-secondary" style="margin-bottom: 16px;">{post.data.description}</p>
                {post.data.tags && (
                  <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    {post.data.tags.slice(0, 4).map((tag) => (
                      <Badge>{tag}</Badge>
                    ))}
                  </div>
                )}
              </Card>
            );
          })}
        </div>
      </section>
    )}

    <!-- Empty State -->
    {publishedPosts.length === 0 && (
      <section style="padding: 64px 0; text-align: center;">
        <h2 class="h2 text-secondary" style="margin-bottom: 16px;">No posts yet</h2>
        <p class="body text-secondary">Articles will appear here when published.</p>
      </section>
    )}

    <!-- Navigation -->
    <nav style="padding: 32px 0; border-top: 1px solid var(--border-color); text-align: center;">
      <a href="/" class="body text-accent">← Back to Home</a>
    </nav>
  </main>
</Layout>
