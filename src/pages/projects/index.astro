---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Card from '../../components/ui/Card.astro';
import Badge from '../../components/ui/Badge.astro';


// Получаем все проекты
const allProjects = await getCollection('projects');
const sortedProjects = allProjects.sort((a, b) => a.data.order - b.data.order);

const currentProjects = sortedProjects.filter(project => project.data.status === 'current');
const completedProjects = sortedProjects.filter(project => project.data.status === 'completed');
const featuredProjects = sortedProjects.filter(project => project.data.featured);
---

<Layout 
  title="Projects - neprokin.com"
  description="Portfolio of product design projects for leading companies and startups"
>
  <main class="container">
    <!-- Header -->
    <header class="page-header">
      <h1 class="h1 text-accent mb-4">Projects</h1>
      <p class="body-large text-secondary mb-8">
        Portfolio of product design work for leading companies and startups
      </p>
    </header>

    <!-- Current Projects -->
    {currentProjects.length > 0 && (
      <section class="section">
        <h2 class="h2 mb-8">Current Work</h2>
        <div class="grid grid-1">
          {currentProjects.map((project) => (
            <Card>
              <div class="card-header">
                <div>
                  <h3 class="body-large mb-1">
                    <a href={`/projects/${project.slug}`} class="text-accent">{project.data.title}</a>
                  </h3>
                  <p class="body text-secondary">{project.data.company} • {project.data.role}</p>
                </div>
                <Badge>Current</Badge>
              </div>
              <p class="body text-secondary card-content">{project.data.description}</p>
              {project.data.technologies && (
                <div class="badge-group mb-4">
                  {project.data.technologies.slice(0, 4).map((tech) => (
                    <Badge>{tech}</Badge>
                  ))}
                </div>
              )}
              <div class="card-footer">
                <a href={`/projects/${project.slug}`} class="body text-accent">View Details →</a>
                {project.data.externalUrl && (
                  <a href={project.data.externalUrl} class="body text-secondary" target="_blank">Live Project ↗</a>
                )}
              </div>
            </Card>
          ))}
        </div>
      </section>
    )}

    <!-- Featured Projects -->
    {featuredProjects.length > 0 && (
      <section class="section">
        <h2 class="h2 mb-8">Featured Work</h2>
        <div class="grid grid-2">
          {featuredProjects.map((project) => (
            <Card>
              <div class="mb-3">
                <h3 class="body-large mb-1">
                  <a href={`/projects/${project.slug}`} class="text-accent">{project.data.title}</a>
                </h3>
                <p class="body text-secondary">{project.data.company} • {project.data.duration}</p>
              </div>
              <p class="body text-secondary card-content">{project.data.description}</p>
              <div class="card-footer">
                <Badge>{project.data.role}</Badge>
                <a href={`/projects/${project.slug}`} class="body text-accent">Details →</a>
              </div>
            </Card>
          ))}
        </div>
      </section>
    )}

    <!-- All Projects -->
    <section class="section">
      <h2 class="h2 mb-8">All Projects</h2>
      <div class="grid grid-2">
        {completedProjects.map((project) => (
          <Card>
            <div class="mb-3">
              <h3 class="body-large mb-1">
                <a href={`/projects/${project.slug}`} class="text-accent">{project.data.title}</a>
              </h3>
              <p class="body text-secondary">{project.data.company} • {project.data.duration}</p>
            </div>
            <p class="body text-secondary card-content">{project.data.description}</p>
            <Badge>{project.data.role}</Badge>
          </Card>
        ))}
      </div>
    </section>

    <!-- Navigation -->
    <nav class="content-nav">
      <a href="/" class="body text-accent">← Back to Home</a>
    </nav>
  </main>
</Layout>
