---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/layout/Navigation.astro';
import Footer from '../components/layout/Footer.astro';
import Button from '../components/ui/Button.astro';
import Badge from '../components/ui/Badge.astro';
---

<Layout title="Neprokin — Simple Design of Complex Systems" description="I develop a system design based on data, user tasks, and common sense">
	<!-- Navigation - используем компонент -->
	<div class="container-wide">
		<Navigation />
	</div>

	<!-- Main Content - узкий контейнер, выровнен по левому краю -->
	<main class="container">
		<!-- Hero Section with Video -->
		<section class="hero-section">
			<div class="hero-grid">
				<!-- Left Content -->
				<div class="hero-content">
					<h1 class="h1 mb-32">
						<span class="text-accent">Simple Design of Complex Systems</span>
						<span class="text-secondary"> in </span>
						<a href="https://dev.2gis.ru/" target="_blank" rel="noopener noreferrer" class="text-secondary">2GIS B2B Platform</a>
					</h1>
					
					<div class="badge-group mb-8">
						<Badge>AI Enthusiast</Badge>
						<Badge>
							<a href="https://en.wikipedia.org/wiki/Brain–computer_interface" target="_blank" rel="noopener noreferrer" class="badge-link">
								BCI
							</a> Enthusiast
						</Badge>
						<Badge>Vibe Coding</Badge>
						<Badge>Vibe Design</Badge>
						<Badge>Product Designer</Badge>
						<Badge>Process Designer</Badge>
						<Button href="https://telegram.me/neprokin">Write in Telegram</Button>
					</div>
				</div>
				
				<!-- Right Video -->
				<div class="hero-video">
					<video 
						autoplay 
						muted 
						loop 
						playsinline
						webkit-playsinline
						class="hero-video-element"
						preload="metadata"
						poster=""
					>
						<source src="/videos/heroLogo.webm" type="video/webm">
						<source src="/videos/heroLogo.mov" type="video/quicktime">
						<!-- Fallback image for browsers that don't support video -->
						<img src="/logo.svg" alt="Neprokin Logo" class="hero-fallback-image">
					</video>
				</div>
			</div>
		</section>

		<!-- Description & Process Section -->
		<section class="section">
			<h2 class="h2 mb-2">I develop a system design based on data, user tasks, and common sense</h2>
			<p class="body-light text-secondary max-w-lg mb-32">
				Concept → Goals → Research → Roles and Context → Tasks → Scenarios → Architecture → Prototype → Interface → Handover to Development → Authorial Supervision
			</p>
		</section>

		<!-- Learning Section -->
		<section class="section">
			<p class="body-light text-secondary mb-16">
				Continuous Learning, Part of the Job
			</p>
			
			<div class="flex-logos">
				<a href="https://gopractice.io/course/pm/" target="_blank" rel="noopener noreferrer" class="company-logo-link">
					<img src="/images/logos/GP.svg" alt="GoPractice Product Management Course" class="company-logo">
				</a>
				<a href="https://dmpatterns.com" target="_blank" rel="noopener noreferrer" class="company-logo-link">
					<img src="/images/logos/PDM.svg" alt="Product Design Masters" class="company-logo">
				</a>
				<a href="https://www.startupschool.org" target="_blank" rel="noopener noreferrer" class="company-logo-link">
					<img src="/images/logos/YC.svg" alt="Y Combinator Startup School" class="company-logo">
				</a>
			</div>
		</section>

		<!-- Portfolio Section -->
		<section class="section">
			<h2 class="h2 mb-8">Large companies and startups trust me</h2>
			
			<!-- Companies Logos Row -->
			<div class="companies-logos">
				<a href="https://dev.2gis.ru/" target="_blank" rel="noopener noreferrer" class="company-logo-link">
					<img src="/images/logos/2GIS.svg" alt="2GIS" class="company-logo">
				</a>
				<a href="https://m2.ru/rieltoram/" target="_blank" rel="noopener noreferrer" class="company-logo-link">
					<img src="/images/logos/M2Pro.svg" alt="M2PRO" class="company-logo">
				</a>
				<a href="https://tech.vk.com/product/tax-compliance-platform" target="_blank" rel="noopener noreferrer" class="company-logo-link">
					<img src="/images/logos/VKTech.svg" alt="VK tech" class="company-logo">
				</a>
				<a href="https://www.skipp.dev/" target="_blank" rel="noopener noreferrer" class="company-logo-link">
					<img src="/images/logos/SKIPP.svg" alt="SKIPP" class="company-logo">
				</a>
				<a href="https://123apps.com/" target="_blank" rel="noopener noreferrer" class="company-logo-link">
					<img src="/images/logos/123APPS.svg" alt="123APPS" class="company-logo">
				</a>
			</div>
			
			<!-- Companies Table (keeping both) -->
			<div class="companies-table">
				<table class="companies-table-content">
					<tbody>
						<tr>
							<td class="company-cell">
								<a href="https://dev.2gis.ru" target="_blank" rel="noopener noreferrer" class="company-link">
									<span class="company-name">2GIS</span>
								</a>
							</td>
							<td class="role-cell">B2B Design Team Lead</td>
							<td class="status-cell">
								<span class="status-current">◉</span>
							</td>
						</tr>
						<tr>
							<td class="company-cell">
								<a href="https://m2.ru/rieltoram/" target="_blank" rel="noopener noreferrer" class="company-link">
									<span class="company-name">M2 Pro</span>
								</a>
							</td>
							<td class="role-cell">Senior Product Designer</td>
							<td class="status-cell">2 yrs</td>
						</tr>
						<tr>
							<td class="company-cell">
								<a href="https://tech.vk.com/product/tax-compliance-platform" target="_blank" rel="noopener noreferrer" class="company-link">
									<span class="company-name">VK Tax Compliance</span>
								</a>
							</td>
							<td class="role-cell">Lead Product Designer</td>
							<td class="status-cell">1 yrs</td>
						</tr>
						<tr>
							<td class="company-cell">
								<a href="https://www.skipp.dev" target="_blank" rel="noopener noreferrer" class="company-link">
									<span class="company-name">Skipp Pro</span>
								</a>
							</td>
							<td class="role-cell">Lead Product Designer</td>
							<td class="status-cell">2 yrs</td>
						</tr>
						<tr>
							<td class="company-cell">
								<a href="https://123apps.com" target="_blank" rel="noopener noreferrer" class="company-link">
									<span class="company-name">123 apps</span>
								</a>
							</td>
							<td class="role-cell">Lead Product Designer</td>
							<td class="status-cell">1 yrs</td>
						</tr>
						<tr>
							<td class="company-cell">
								<span class="company-link">
									<span class="company-name">Valov & Neprokin</span>
								</span>
							</td>
							<td class="role-cell">Designer · Manager · Owner</td>
							<td class="status-cell">3 yrs</td>
						</tr>
						<tr>
							<td class="company-cell">
								<span class="company-link">
									<span class="company-name">Independent Designer</span>
								</span>
							</td>
							<td class="role-cell">Designer · Manager</td>
							<td class="status-cell">5 yrs</td>
						</tr>
					</tbody>
				</table>
			</div>
		</section>
	</main>

	<!-- Footer Section - широкий контейнер как шапка -->
	<div class="container-wide">
		<Footer />
	</div>
</Layout>

<script>
	// Hero Video Controller для оптимизации производительности
	class HeroVideoController {
		private video: HTMLVideoElement | null;
		
		constructor() {
			this.video = document.querySelector('.hero-video-element') as HTMLVideoElement | null;
			this.init();
		}
		
		init() {
			if (!this.video) return;
			
			this.setupIntersectionObserver();
			this.setupPreload();
			this.handleVisibilityChange();
		}
		
		setupIntersectionObserver() {
			if (!this.video) return;
			
			const observer = new IntersectionObserver((entries) => {
				entries.forEach(entry => {
					if (entry.isIntersecting) {
						this.playVideo();
					} else {
						this.pauseVideo();
					}
				});
			}, { threshold: 0.5 });
			
			observer.observe(this.video);
		}
		
		setupPreload() {
			if (!this.video) return;
			
			// Предзагрузка только метаданных для экономии трафика
			this.video.preload = 'metadata';
			
			// Загрузка видео при hover
			this.video.addEventListener('mouseenter', () => {
				if (this.video && this.video.readyState < 3) {
					this.video.load();
				}
			});
		}
		
		handleVisibilityChange() {
			document.addEventListener('visibilitychange', () => {
				if (document.hidden) {
					this.pauseVideo();
				} else {
					this.playVideo();
				}
			});
		}
		
		playVideo() {
			if (this.video && this.video.paused) {
				this.video.play().catch(console.log);
			}
		}
		
		pauseVideo() {
			if (this.video && !this.video.paused) {
				this.video.pause();
			}
		}
	}
	
	// Инициализация при загрузке страницы
	document.addEventListener('DOMContentLoaded', () => {
		new HeroVideoController();
	});
	
	// Safari Video Controller для устранения черного фона
	class SafariVideoController {
		private isSafari: boolean;
		private video: HTMLVideoElement | null;
		
		constructor() {
			this.isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
			this.video = document.querySelector('.hero-video-element') as HTMLVideoElement;
			
			if (this.isSafari && this.video) {
				this.init();
			}
		}
		
		init() {
			// Принудительно устанавливаем прозрачный фон
			this.forceTransparentBackground();
			
			// Обработка событий загрузки
			this.video!.addEventListener('loadeddata', () => {
				this.forceTransparentBackground();
			});
			
			this.video!.addEventListener('canplay', () => {
				this.forceTransparentBackground();
			});
			
			this.video!.addEventListener('playing', () => {
				this.forceTransparentBackground();
			});
			
			// Дополнительные проверки через интервалы
			setTimeout(() => this.forceTransparentBackground(), 100);
			setTimeout(() => this.forceTransparentBackground(), 500);
			setTimeout(() => this.forceTransparentBackground(), 1000);
			setTimeout(() => this.forceTransparentBackground(), 2000);
		}
		
		forceTransparentBackground() {
			if (!this.video) return;
			
			// Принудительно устанавливаем прозрачный фон для видео
			this.video.style.background = 'transparent';
			this.video.style.backgroundColor = 'transparent';
			this.video.style.backgroundImage = 'none';
			
			// Используем setProperty для принудительного применения
			this.video.style.setProperty('background', 'transparent', 'important');
			this.video.style.setProperty('background-color', 'transparent', 'important');
			this.video.style.setProperty('background-image', 'none', 'important');
			
			// Также для родительского элемента
			const parent = this.video.parentElement;
			if (parent) {
				parent.style.background = 'transparent';
				parent.style.backgroundColor = 'transparent';
				parent.style.backgroundImage = 'none';
				parent.style.setProperty('background', 'transparent', 'important');
				parent.style.setProperty('background-color', 'transparent', 'important');
				parent.style.setProperty('background-image', 'none', 'important');
			}
			
			// Дополнительные Safari-специфичные стили
			this.video.style.setProperty('object-fit', 'contain', 'important');
			this.video.style.setProperty('mix-blend-mode', 'normal', 'important');
		}
	}
	
	// Инициализация Safari контроллера
	document.addEventListener('DOMContentLoaded', () => {
		new SafariVideoController();
	});
</script>

